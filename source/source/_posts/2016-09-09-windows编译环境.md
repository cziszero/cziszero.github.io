---
layout: post
title: 关于windows编译环境的一些东西
description: 写了一些在配置编译环境的时候的一些经验和教训
date: 2016-09-09
categories: 
  - [软件安装和使用]
  - [语言 , C/C++]
tags:
  - 编译器
  - 软件安装和使用
  - C/C++
  - 环境配置
---

## 关于windows编译环境的一些东西
事情的起源是这样的，因为要做安全保密课的大作业，需要用到openSSL，于是下载了openSSL的源代码，
下载下来发现没有make文件，需要先下个perl，然后就放弃了。找到了一个编译好的windows上可以用的库
，然后想这下大功告成了吧，万万没想到啊，这才是苦难的开始。

首先是QT中引用库的配置，可以以交互的方式来添加库文件，即右键项目，选择添加库，然后发现有三个
选项：内部库，外部库，系统库。鸟知道这三个啥区别啊，那就逐个点点试试呗。点内部库发现需要添加的
是在项目目录中的库，点外部库发现是要添加项目目录外的库文件，不光要添加库文件，还要添加头文件，
点系统库只让添加一个库，发现只要选一个库文件添加上就好。然后观察才pro文件中添加的信息发现并没有
什么大的区别，只是库文件目录不大一样而已。只是增加几个项，INCLUDEPATH ，DEPENDPATH，LIBS。
LIBS和INCLUDEPATH的含义很好理解，即库文件和包好目录，LIBS的实例如：
`LIBS += -LC:/OpenSSL-Win64/lib/ -llibeay32` 可以观察出结构，即`-L`添加目录，`-l`添加文件。注意，
库文件最后的`.lib`是要省略的，但前面的不能省略，另外目录分隔符是unix的格式。`INCLUDEPATH`的书写
更简单，如：`INCLUDEPATH += C:/OpenSSL-Win64/include` ，这里还要吐槽一点，采用上面说的交互
的方式添加库时会自动在目录前面添加`$$PWD/`，导致编译的时候找不到库目录，删掉就好了。另外，采用
交互方式添加库是还让选择平台（win，linux，mac）和静态库还是动态库，以及debug模式还是release
模式，经过观察发现，选为静态库的时候会加入`PRE_TARGETDEPS`一项的配置，但目前还不知道什么用。
总之，经过实验发现，添加库的时候采用直接更改pro文件的方式就可以了，比较简单，如果有平台要求等
可以用交互方式添加下看看格式。另外，还有QT的两个配置项（`DEPENDPATH`，`PRE_TARGETDEPS`）
没有搞清楚其含义，留待以后查一下。

另外，关于QT中添加动态库有两种方式，显式添加手动解析和隐式链接。
添加知道怎么在QT工程里添加库后，我兴奋的添加上，想马上就可以大展手脚了。然而。。
下载下来的库目录是这样的
	│  4758cca.lib
	│  aep.lib
	│  atalla.lib
	│  capi.lib
	│  chil.lib
	│  cswift.lib
	│  gmp.lib
	│  gost.lib
	│  libeay32.lib
	│  nuron.lib
	│  padlock.lib
	│  ssleay32.lib
	│  sureware.lib
	│  ubsec.lib
	│
	└─VC
		│  libeay32MD.lib
		│  libeay32MDd.lib
		│  libeay32MT.lib
		│  libeay32MTd.lib
		│  ssleay32MD.lib
		│  ssleay32MDd.lib
		│  ssleay32MT.lib
		│  ssleay32MTd.lib
		│
		└─static
				libeay32MD.lib
				libeay32MDd.lib
				libeay32MT.lib
				libeay32MTd.lib
				ssleay32MD.lib
				ssleay32MDd.lib
				ssleay32MT.lib
				ssleay32MTd.lib
[MT和MD]的区别前段时间我刚刚知道，然后排除带d后缀的是debug时使用的，然后还剩下了
	│  4758cca.lib
	│  aep.lib
	│  atalla.lib
	│  capi.lib
	│  chil.lib
	│  cswift.lib
	│  gmp.lib
	│  gost.lib
	│  libeay32.lib
	│  nuron.lib
	│  padlock.lib
	│  ssleay32.lib
	│  sureware.lib
	│  ubsec.lib
	└─VC
		│  libeay32MD.lib
		│  libeay32MT.lib
		│  ssleay32MD.lib
		│  ssleay32MT.lib
		└─static
				libeay32MD.lib
				libeay32MT.lib
				ssleay32MD.lib
				ssleay32MT.lib
但还有上面的杂七杂八的库是干嘛用的，我看了下readme文档和帮助文档，也没说怎么使用，不过难不住
会使用搜索引擎的我啊。经过一番搜索，发现在调用openSSL的时候只要连接libeay32和ssleay两个库就
可以了。其中，libeay32主要用于加密解密相关功能，ssleay主要用于SSL相关功能。确定了这个，
接下来只要确定QT使用的什么编译选项（MD/MT），然后在pro文件里添加上就行了呗，这时我的内心
是充满希望的。确定QT使用的什么编译选项（MD/MT）怎么能难倒我呢，我一下就找到对应平台的
qmake的配置文件（qmake现在也不大清楚，需要查一下），例如我的是在
`C:\Qt\Qt5.4.1\5.4\msvc2013_64_opengl\mkspecs\win32-msvc2013\qmake.conf`，打开看了下是
使用`/MD`的编译选项，然后我就把static文件夹下的libeay32MD.lib ssleay32MD.lib都给添加上了，然后
去网上找了段代码，没添加库之前一大堆找不到符号，添加库之后只有三个找不到符号了。。。尼玛，
就三个。。还是编译不过，我也不知道是什么问题，我以为是我还漏掉了哪个库文件。然后各种google，
奈何别人好像都没碰到。。。不过在还是学到了一些新知识。前面有贴了下载下来的编译好的库目录，看到
他是我还比较困惑为什么外层有.lib还有个内层的static文件夹存了一些.lib文件。lib不已经是静态链接库了么，
那里面的和外面的有什么区别呢？以前也查过这方面的资料，但都是浅尝辄止了，没有真正认认真真学过，
这次终于知道在windows以.lib结尾的并不一定都是静态链接库。首先库分为静态链接库和动态链接库两种，
静态链接库是在编译链接的时候就和其他的打包在一起，链接好之后就可以单独运行了，而静态库也只需要
提供一个lib库文件。但动态链接库在生成的时候还会伴随着产生一个lib文件，这个文件是动态链接库的
索引文件，会比静态链接库产生的lib文件小很多。动态链接库是在运行时链接的，在build阶段link时
并不会打包到一起，所以如果需要在别的地方运行还要把该dll考过去。在程序中使用动态链接库时，如果
显式的引用动态链接库则不需要添加lib文件，但需要手动解析。如果隐式的使用动态链接库，则需要把
索引用的lib文件添加在编译选项中，然后之后的加载由操作系统自动完成。[更多资料请参考]

然后一段时间过去了，我想不会是下载下来的这个编译好的包有问题吧。。。那我还是自己编译试试吧。
然后我又去查了openSSL的编译方法，这个资料挺多的，例如[这个][]。
VS的目录结构
cl的编译选项
[这个]:	http://blog.csdn.net/xiexievv/article/details/45114235
>	如何在Windows下编译OpenSSL （VS2010使用VC10的cl编译器）
>	1、安装ActivePerl,初始化的时候,需要用到perl解释器
>	2、使用VS2010下的Visual Studio 2010 Command Prompt进入控制台模式
>	（这个模式会自动设置各种环境变量）
>	3、解压缩openssl的包,进入openssl的目录
>	4、perl configure VC-WIN32
>	尽量在这个目录下执行该命令，否则找不到Configure文件，或者指定完整的Configure文件路径。
>	5、`ms\do_ms.bat`,在解压目录下执行ms\do_ms.bat命令
>	6、`nmake -f ms\ntdll.mak`
>	7、`nmake -f ms\nt.mak`
>	
>	测试动态库：
>	    nmake -f ms\ntdll.mak test
>	    测试静态库：
>	    nmake -f ms\nt.mak test
>	    安装动态库：
>	    nmake -f ms\ntdll.mak install
>	    安装静态库：
>	    nmake -f ms\nt.mak install
>	    清除上次动态库的编译，以便重新编译：
>	    nmake -f ms\ntdll.mak clean
>	    清除上次静态库的编译，以便重新编译：
>	    nmake -f ms\nt.mak clean
咦，当时找的时候不是找到的这篇博文，找到这篇博文的话可能还省点事，当时找到的第二步都是让在
运行`vcvarsall.bat x86`，我也找到了这个文件，是在C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC
这个目录下，在这个目录下成功的执行 `vcvarsall.bat x86`，然后继续往后做，悲剧发生了。后面的第6步第7步
不行，老是提示找不到include的文件，现在看来这很明显是没有配好环境嘛，但当时头脑有点混乱。算了算了，
过去这么长时间了，当时的也记不大清楚了，就只写结果吧，本来还想写的生动有趣一点呢。。。

发现是环境没有配好后，我就开始探索VS的目录结构，毕竟这个已经困扰我好久了。
首先在C:\Program Files (x86)目录下我一下就看到了Microsoft Visual Studio 11.0、Microsoft Visual Studio 12.0、
Microsoft Visual Studio 14.0，然后知道这是不同的版本，其中11.0对应Visual Studio 2012，12.0对应Visual Studio 2013，
14.0对应Visual Studio 2015，那我找到主版本就行了。我机子上安装的版本是2013。

感悟：
想到就立即去做
遇事要冷静，想想怎样做最优。


https://msdn.microsoft.com/en-us/library/x4d2c09s(VS.80).aspx
版本号http://baike.baidu.com/view/261613.htm#6
linux编译64位和32位的编译选项。