---
layout: post
title: 计算机网络学习之数据链路层
description: 计算机网络课程笔记
date: 2015-09-19
categories: 
  - 课程
  - 计算机网络
tags:
  - 计算机网络
---

## 基本概念
*　链路(link)——是一条无源的点到点的物理线路段，中间没有任何其他的交换结点。
*　通路（path）——由一连串的链路和中间节点构成的源到目的路径。
*　　数据链路(data link)—— 除了物理线路外，还必须有通信协议来控制数据在链路上的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
*　帧（frame）——在数据链路上传递的数据单元一般被称为帧，帧一般由帧头、帧内容、帧尾三部分构成。
－帧头表示帧的开始；
－帧尾表示帧的结束；
－帧内容一般分为协议控制和数据两部分。
## 涉及问题
提供的服务
链路管理
帧定界
差错控制
流量控制
将数据和控制信息区分
透明传输
寻址
## 提供的服务
数据链路层的最主要作用在于通过建立长期、临时数据链路，实现帧的传输，为上层提供信息的非路由传递功能。
分类：（面向连接，无连接(有确认，无确认)）
## 帧定界与透明传输
### 字符计数法
利用头部中的一个域来指定该帧中的字符数，接收端通过字符计数值来知道帧的结束，要求线路是按字符为单位进行传递的，字符的界定是由低层完成。
### 带字符填充的首尾界符法
![](/images/ComputerNetWorkDataLinkLayer_01.png)
在字符计数法上考虑到错误之后的同步问题，让每一个帧都用一些特殊的字符作为帧的开始与结束；绝大多数协议都使用相同的字节作为开始与结束标志，被称为标志字节（flag byte）,也称为起始和结束分界符，连续出现的两个字符代表了当前帧的结束和下一帧的开始。

透明传输的含义在于避免在有效载荷域中出现的与首尾界符相同的字符对帧界定工作的影响。其采用的方法是在有效载荷域中出现的每个标志字节前插入一个特殊的转义字节（ESC），接收端在将数据传送给网络层之前删除掉转义字符，这种技术被称为字节填充（byte stuffing）或字符填充（character stuffing）。有效载荷中出现的转义字符也必须同样处理。
### 带位填充的首尾标志法
在以二进制为最小传输单位的数据链路中，由于数据帧的长度是任意的比特长度，所以采用在每一个帧的开始与结束都添加一个特殊的标志二进制串，例如“01111110”，称为帧起始与结束标志。

透明传输的含义在于避免在有效载荷域中出现的与首尾标志相同的二进制串对帧的界定造成影响。
　　例如对“01111110”,其采用的方法是：如果发送端在发送有效载荷时，如果每遇到５个“1”后，就在其后添加一个“0”；接收端如果在接收有效负载时，遇到连续的５个“1”，就会讲其后的“0”去掉，这种位填充（bit stuffing）机制与字节填充机制类似。

### 物理编码违例法　　
在传输过程中，利用码元的非有效状态来做为数据帧的起始。(详见ppt page13)
## 差错控制
差错控制主要用于对传递的帧进行校验，发现错误就采用重发或纠错。

主要差错情况(正常；数据帧出错；数据帧丢失；确认帧丢失)
实用的数据链路层协议大都不采用否认帧进行差错通知，由是采用检验出错误后，不发确认帧，导致发送方超时重传。 

两大机制(计时器；帧编号)
### 计时器
![](/images/ComputerNetWorkDataLinkLayer_05.png")
重传时间的作用是：数据帧发送完毕后若经过了这样长的时间还没有收到确认帧，就重传这个数据帧。 
为方便起见，我们设重传时间为tout = tp + tpr+ ta + tp + tpr                  　　　 
设上式右端的处理时间 tpr 和确认帧的发送时间 ta 都远小于传播时延 tp，因此可将重传时间取为两倍的传播时延，即tout = 2tp

两个发送成功的数据帧之间的最小时间间隔是tT = tf + tout = tf  + 2tp                            　　　 
设数据帧出现差错(包括帧丢失)的概率为 p，但假设确认帧不会出现差错。
设正确传送一个数据帧所需的平均时间 tav

tav = tT ( 1 + 一个帧的平均重传次数)  
![](/images/ComputerNetWorkDataLinkLayer_06.png)
### 帧编号
任何一个编号系统的序号所占用的比特数一定是有限的。因此，经过一段时间后，发送序号就会重复。
序号占用的比特数越少，数据传输的额外开销就越小。
对于停止等待协议，由于每发送一个数据帧就停止等待，因此用一个比特来编号就够了。一个比特可表示 0 和 1 两种不同的序号。
数据帧的发送序号 N(S) 以 0 和 1 交替的方式出现在数据帧中。
每发一个新的数据帧，发送序号就和上次发送的不一样。用这样的方法就可以使收方能够区分开新的数据帧和重传的数据帧了。

## 流量控制
流量控制——最重要的就是高速发送者与低速接受者之间的流量控制的问题 。
![](/images/ComputerNetWorkDataLinkLayer_02.png)

## 停止等待协议
### 最简单流量控制
在发送结点的发送操作：
    (1) 从主机取一个数据帧。
    (2) 将数据帧送到数据链路层的发送缓存。
    (3) 将发送缓存中的数据帧发送出去。
    (4) 等待。
    (5) 若收到由接收结点发过来的信息(此信息的格式与内容可由双方事先商定好)，则从主机取一个新的数据帧，然后转到(2)。
在接收结点的接收操作：
    (1) 等待。
    (2) 若收到由发送结点发过来的数据帧则将其放入数据链路层的接收缓存。
    (3) 将接收缓存中的数据帧上交主机。
    (4) 向发送结点发一信息，表示数据帧已经上交给主机。
    (5) 转到(1)。
![](/images/ComputerNetWorkDataLinkLayer_03.png)
![](/images/ComputerNetWorkDataLinkLayer_04.png)
### 实际算法
按照习惯的表示法，ACKn 表示“第 n – 1 号帧已经收到，现在期望接收第 n 号帧”。
在帧序列位数为1时：
ACK1 表示“0 号帧已收到，现在期望接收的下一帧是 1 号帧”；
ACK0 表示“1 号帧已收到，现在期望接收的下一帧是 0 号帧”。
发送节点：
(1) 从主机取一个数据帧，送交发送缓存。
(2) V(S)←0。// V(S)、N(S) 是当前帧号，N(S)写入帧中，V(S)存于本节点。
(3) N(S)←V(S)。
(4) 将发送缓存中的数据帧发送出去。 
(5) 设置超时计时器。
(6) 等待。//等待以下(7)和(8)这两个事件中最先出现的一个
(7) 收到确认帧 ACKn，   
      若 n = 1 – V(s)，则：
           从主机取一个新的数据帧，放入发送缓存；
           V(S)←[1 -V(S)]，转到 (3)。    
      否则，丢弃这个确认帧，转到(6)。 
(8) 若超时计时器时间到，则转到(4)。
接受节点：
(1)  V(R)←0。
(2)  等待。
(3)  收到一个数据帧；
           若 N(S) = V(R)，则执行(4)；
           否则丢弃此数据帧，然后转到(6)。
(4)  将收到的数据帧中的数据部分送交上层软件
        （也就是数据链路层模型中的主机）。
(5)  V(R)←[1 - V(R)]。
(6)  n←V(R)；发送确认帧 ACKn，转到(2)。 
优点：比较简单 。
缺点：通信信道的利用率不高，也就是说，信道还远远没有被数据比特填满。
为了克服这一缺点，就产生了另外两种协议，即连续 ARQ 和选择重传 ARQ。
## 连续ARQ
由于出现帧丢失或确认丢失后，导致连续n帧重传，所以又被称为退后n帧协议。
工作原理

在发送完一个数据帧后，不是停下来等待确认帧，而是可以连续再发送若干个数据帧。
如果这时收到了接收端发来的确认帧，那么还可以接着发送数据帧。
由于减少了等待时间，整个通信的吞吐量就提高了。 

![](/images/ComputerNetWorkDataLinkLayer_07.png)
![](/images/ComputerNetWorkDataLinkLayer_08.png)

### 要点
1.		接收端只按序接收数据帧。虽然在有差错的 2号帧之后接着又收到了正确的 3 个数据帧，但接收端都必须将这些帧丢弃，因为在这些帧前面有一个 2 号帧还没有收到。虽然丢弃了这些不按序的无差错帧，但应重复发送已发送过的最后一个确认帧（防止确认帧丢失）。

2. 	ACK1 表示确认 0 号帧 DATA0，并期望下次收到 1 号帧；ACK2 表示确认 1 号帧 DATA1，并期望下次收到 2 号帧。依此类推。

3.		结点 A 在每发送完一个数据帧时都要设置该帧的超时计时器。如果在所设置的超时时间内收到确认帧，就立即将超时计时器清零。但若在所设置的超时时间到了而未收到确认帧，就要重传相应的数据帧（仍需重新设置超时计时器）。
 在等不到 2 号帧的确认而重传 2 号数据帧时，虽然结点 A 已经发完了 5 号帧，但仍必须向回走，将 2号帧及其以后的各帧全部进行重传。连续 ARQ 又称为Go-back-N ARQ，意思是当出现差错必须重传时，要向回走 N 个帧，然后再开始重传。 

### 滑动窗口
1.		发送端和接收端分别设定发送窗口和接收窗口 。
2.		发送窗口用来对发送端进行流量控制。
3.		发送窗口的大小 WT 代表在还没有收到对方确认信息的情况下发送端
最多可以发送多少个数据帧。

当用 n 个比特进行编号时，若接收窗口的大小为 1，则只有在发送窗口的大小 WT <=2^n -1时，连续 ARQ 协议才能正确运行。
   (所有确认帧都丢失,重传帧被当成新的一轮帧)




## 选择重传ARQ

