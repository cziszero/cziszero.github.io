---
layout: post
title: 上下文无关文法 CFG
description: 编译原理笔记之上下文无关文法
date: 2015-10-31
categories: 
  - 课程
  - 编译原理
tags:
  - 编译原理
---

## 上下文无关文法(Context-Free Grammar, CFG)
**定义**：
G = {T; N; S; P}, 其中：T 是有限字母表，其元素称
为终结符号(terminals);N 是有限语法成分标记集合，
N ∩ T = Φ，称为非终结符号(non-terminals)，
相当于递归定义的元变量;S ∈ N 称为文法开始符号;
P = {Si → w | Si ∈ N; w ∈(T ∪ N)*}
是一个有限的集合，其元素称为产生式。

**产生式概念**：Backus-Naur Form (BNF, 源于Agcol60)。
Terminal = 字母; Non-terminal = 递归定义中
的metavariable。

产生式左边(Left Hand Side, LHS)一定是唯一的一个
非终结符。
产生式右边(Right Hand Side, RHS)可以是空串，称
为空产生式。

一个非终结符可以有多个产生式对应, 可用``|'' 连接
其对应的RHS。

## 推导

### 两个不确定性。
1.	选择句型中的非终结符展开。
2.	选择产生式。

### 最左推导和最右推导
**最左推导lm**：每次推导都是对句型中的最左边的非终结符展开, 称为最左推导。

**最右推导rm**：每次推导都是对句型中的最右边的非终结符展开, 称为最右推导。

**最左句型(leftmost sentential form)** ：如果能由
最左推导得到则为最左句型。

**最右句型(rightmost sentential form) **：如果能由
最右推导得到则为最右句型。

最左推导是最左边的文法符号形成为终结符，最右推
导是最右边的文法符号形成为终结符。

每条语句既是左句型又是右句型;
语法分析的过程就是模拟这两种推导，即对这两种句型的识别。

## 语法树
语法树与推导的关系

*	语法树的内部节点一定是非终结符。
*	语法树过滤掉了推导过程对非终结符选择策略。
*	一个推导过程等价于对语法树的语法树的遍历过程。
*	最左推导是前序遍历(树根→ 左儿子→ 右儿子)。 最右推导是NRL：树根→ 右儿子→ 左儿子。
* 	α是最左句型，iff 存在一颗语法树，其前序遍历得到的叶结点序列是α。
*	α是最右句型，iff 存在一颗语法树，其NRL 遍历得到的叶结点序列是α。
*	一颗语法树对应唯一的一个最左推导和唯一的一个最右推导。
*	语法分析也可以看成建立语法树的过程。

## 二义性(Ambiguity)
称CFG G 是二义性文法 iff 存在一语句有两颗不同
的语法树 iff 存在一语句有两个不同的最左(右) 推导。

二义性导致了语法分析的不确定性，同样的语句有
不同的理解，在文法设计时要避免。
## CFG与RE
形如后者的文法称为正则文法或右线性文法。P52

正则语言都能用CFG 描述，所以CFG 的表达能力强于前者。

为什么要使用两级抽象？

上下文无关文法的表达能力比正则表达式强，因此
形式语言的识别完全可以一级抽象“字母 → 语法”，
不需要“字母→ 单词→ 语法”二级抽象。但文法的
识别远比正则表达式复杂。采用二级抽象可以显著
降低语法分析的负担。

Extended Backus–Naur Form(EBNF)允许产生式
右边为正则表达式：`exp → term (+ term)*`
这样只用一级抽象就可以同时描述词法和语法，
如XML 规范，语法自动生成工具[ANTLR](http://www.antlr.org/) 等采用EBNF，
但在识别时还是分解成两级结构。

## 自动机和CFG
自动机可以转化为CFG

**自动机与CFG的对应关系**

1.	每个状态对应一个非终结符，开始状态对应文法开始符号。
2. if i→a→j , then：Si → aSj。
3. 如果 i 是接受状态，则增加产生式：Si → ε;

**自动机与CFG的关系**

1.	程序设计语言一般是CFL。
2.	DFA 不能识别CFL。
3.	CFG 与不确定的下推自动机等价。
4.	不确定的下推自动机与确定的下推自动机不等价。
5.	无回溯的语法分析器仅能识别部分的CFL。

### 下推自动机
>	下推自动机不是有限状态自动机FA且比有限状态自动机
FA复杂：除了有限状态组成部分外，还包括一个长度不
受限制的栈；下推自动机的状态迁移不但要参考有限
状态部分，也要参照栈当前的状态；状态迁移不但包括
有限状态的变迁，还包括一个栈的出栈或入栈过程。
下推自动机可以形象的理解为，借由加上读取一个容量
无限栈的能力，扩充一个能做ε转移的非确定有限状态自动机。
下推自动机存在“确定”与“非确定”两种形式，两者
并不等价。（对有限状态自动机两者是等价的）
每一个下推自动机都接受一个形式语言。
被“非确定下推自动机”接受的语言是上下文无关语言。
如果我们把下推自动机扩展，允许一个有限状态自动机存取
两个栈，我们得到一个能力更强的自动机，
这个自动机与图灵机等价。

## 参考
大部分内容来自上课时老师的[课件](../docs/grammar.pdf)，仅作总结，如有侵权，告知即删。

下推自动机部分来自[wikipedia](https://zh.wikipedia.org/wiki/%E4%B8%8B%E6%8E%A8%E8%87%AA%E5%8A%A8%E6%9C%BA)