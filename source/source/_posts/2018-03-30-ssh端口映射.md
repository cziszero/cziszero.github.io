---
layout: post
title: ssh -L端口映射
description: 
date: 2018-03-30
categories: 
  - [linux]
  - [软件安装和使用] 
tags:
  - linux
  - 软件安装和使用
---

# ssh的一些参数含义

*    -1：强制使用ssh协议版本1；
*    -2：强制使用ssh协议版本2；
*    -4：强制使用IPv4地址；
*    -6：强制使用IPv6地址；
*    -A：开启认证代理连接转发功能；
*    -a：关闭认证代理连接转发功能；
*    -b：使用本机指定地址作为对应连接的源ip地址；
*    -C：请求压缩所有数据；
*    -F：指定ssh指令的配置文件；
*    -f：后台执行ssh指令；
*    -g：允许远程主机连接主机的转发端口；
*    -i：指定身份文件；
*    -l：指定连接远程服务器登录用户名；
*    -N：不执行远程指令；
*    -o：指定配置选项；
*    -p：指定远程服务器上的端口；
*    -q：静默模式；
*    -X：开启X11转发功能；
*    -x：关闭X11转发功能；
*    -y：开启信任X11转发功能。

`/etc/ssh/ssh_config` 是客户端配置文件
`/ect/ssh/sshd_config`  是服务器端配置文件

# -L端口转发

这次只用到了`-L`选项，对这个搞得比较清楚了，所以详细总结一下这个选项。
本文从这篇[blog](https://www.cnblogs.com/xuxiuxiu/p/6269538.html)中学到很多，最终总结也只是其中一部分，还盗用了两个图，如有侵权，告知即删。

首先直接看下man中的用法说明：
> -L [bind_address:]port:host:hostport
> -L [bind_address:]port:remote_socket
> -L local_socket:host:hostport
> -L local_socket:remote_socket
>    Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given host and port, or Unix socket, on the remote side.  This works by allocating a socket to listen to either a TCP port on the local side, optionally bound to the specified bind_address, or to a Unix socket.  Whenever a connection is made to the local port or socket, the connection is forwarded over the secure channel, and a connection is made to either host port hostport, or the Unix  socket remote_socket, from the remote machine.
>    Port forwardings can also be specified in the configuration file.  Only the superuser can forward privileged ports.  IPv6 addresses can be specified by enclosing the address in square brackets.
>    By default, the local port is bound in accordance with the GatewayPorts setting.  However, an explicit bind_address may be used to bind the connection to a specific address.  The bind_address of “localhost” indicates that the listening port be bound for local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.  

(其实这里面说的非常清楚了，不光把我这次踩得坑直接点出来了，还说了很多不知道的用法，所以以后遇到这种问题，先看官方的文档，解决不了再去找，要不然实在太浪费时间了。)

## 功能  
简单的说就是把远程主机的端口映射到本地主机上的某个端口。
从上面的用法中可以发现几个值得注意的地方


## 两台主机
网络拓扑如下图所示：
![](/images/2host.jpg)

主机A想要访问主机B上的某个服务，但不想输入B的地址或者是将`localhost`硬编码在code中，那只能借助




